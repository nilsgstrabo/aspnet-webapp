apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: oauth-demo
spec:
  environments:
    - name: prod
      build:
        from: release
    - name: dev
      build:
        from: main
  components:
    # - name: web
    #   image: bitnami/redis:latest
    #   ports:
    #     - name: redis
    #       port: 6379
    - name: web
      variables:
        ASPNETCORE_URLS: http://*:5005
      secretRefs:
        azureKeyVaults:                    #Azure Key vault configuration, common for the component
          - name: radix-app-secrets-2
            path: /mnt/secrets                   #overrides default "path", where secrets, keys and certificates are available as files
            items:
              - name: connection-string-test     #example value "server:prod" in Azure Key vault "radix-app-secrets"
                envVar: CONNECTION_STRING        #default environment variable CONNECTION_STRING
              - name: db-qa-user                    #example value "readeruser" in Azure Key vault "radix-app-secrets"
                envVar: DB_USER                  #default environment variable DB_USER
              - name: db-password                #example value "Pa$$w0rd!" in Azure Key vault "radix-app-secrets"
                envVar: DB_PASS 
      ports:
        - name: http
          port: 5005
      publicPort: http
      resources:
        requests:
          memory: "150M"
          cpu: "100m"
        limits:
          memory: "500M"
          cpu: "100m"
    - name: web-component-with-very-long-name-causing-error
      variables:
        ASPNETCORE_URLS: http://*:5006
      secretRefs:
        azureKeyVaults:                    #Azure Key vault configuration, common for the component
          - name: radix-app-secrets-2
            path: /mnt/secrets                   #overrides default "path", where secrets, keys and certificates are available as files
            items:
              - name: connection-string-test     #example value "server:prod" in Azure Key vault "radix-app-secrets"
                envVar: CONNECTION_STRING        #default environment variable CONNECTION_STRING
              - name: db-qa-user                    #example value "readeruser" in Azure Key vault "radix-app-secrets"
                envVar: DB_USER                  #default environment variable DB_USER
              - name: db-password                #example value "Pa$$w0rd!" in Azure Key vault "radix-app-secrets"
                envVar: DB_PASS 
      ports:
        - name: http
          port: 5005
      publicPort: http
      resources:
        requests:
          memory: "150M"
          cpu: "100m"
        limits:
          memory: "500M"
          cpu: "100m"
    # - name: web-redis
    #   authentication:
    #     oauth2: 
    #       clientId: 5e48ca1f-a2bf-4dec-b96d-bbf8ce69f9f6
    #       scope: openid email offline_access
    #       setXAuthRequestHeaders: true
    #       setAuthorizationHeader: true
    #       sessionStoreType: redis
    #       redisStore:
    #         connectionUrl: redis://redis:6379
    #   variables:
    #     ASPNETCORE_URLS: http://*:5005
    #   ports:
    #     - name: http
    #       port: 5005
    #   publicPort: http
    #   resources:
    #     requests:
    #       memory: "150M"
    #       cpu: "1000m"
    #     limits:
    #       memory: "500M"
    #       cpu: "1000m"
    # - name: redis
    #   image: bitnami/redis:latest
    #   secrets:
    #     - REDIS_PASSWORD
    #   ports:
    #     - name: redis
    #       port: 6379
    # - name: web-cookie
    #   authentication:
    #     oauth2:
    #       clientId: 5e48ca1f-a2bf-4dec-b96d-bbf8ce69f9f6
    #   variables:
    #     ASPNETCORE_URLS: http://*:5005
    #   ports:
    #     - name: http
    #       port: 5005
    #   publicPort: http
    #   resources:
    #     requests:
    #       memory: "150M"
    #       cpu: "1000m"
    #     limits:
    #       memory: "500M"
    #       cpu: "1000m"
  # dnsAppAlias:
  #   environment: qa
  #   component: web-redis
