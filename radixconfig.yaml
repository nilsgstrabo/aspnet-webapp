apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: nils-simple-webapp
spec:
  environments:
    - name: qa
      build:
        from: main
  components:
    - name: "server"
      variables:
        ASPNETCORE_URLS: "http://*:5005"
      authentication:
        oauth2:
          scope: "openid profile email" #<optional default: openid profile email offline_access>
          setXAuthRequestHeaders: true #<optional, default false>
          emailDomain: "gmail.com" #<optional, default *>
          loginUrl: "foo" #<optional>
          redeemUrl: "bar" #<optional>
          proxyPrefix: "baz" #<optional, default /oauth2>
          oidc:
            issuerUrl: "1-foo" #<optional default to https://login.microsoftonline.com/3aa4a235-b6e2-48d5-9195-7fcf05b459b0/v2.0> 
            jwksUrl: "1-bar" #<optional>
            groupsClaim: groups #<optional, default groups>
            skipDiscovery: false #<optional, default false>
          sessionStoreType: cookie #<optional, default>
          cookieStore:
            minimal: true #<optional, default>
          redisStore:
            connectionUrl: "redis://localhost:123" #<required>
          cookie:
            name: _oauth2_proxy #<optional, default>
            path: "/" #<optional, default>
            domain: "equinor.com" #<optional, default>
            expire: "168h" #<optional, default>
            sameSite: "strict" #<optional, default>
      environmentConfig:
        - environment: qa
          authentication:
            oauth2:
              clientId: 5687b237-eda3-4ec3-a2a1-023e85a2bd84 #<required>
              scope: "openid profile email offline_acccess" #<optional default: openid profile email offline_access>
              setXAuthRequestHeaders: false #<optional, default false>
              setAuthorizationHeader: true #<optional, default false>
              emailDomain: "gmail.com" #<optional, default *>
              loginUrl: "foo" #<optional>
              redeemUrl: "bar" #<optional>
              proxyPrefix: "baz" #<optional, default /oauth2>
              oidc:
                issuerUrl: "2-foo" #<optional default to https://login.microsoftonline.com/3aa4a235-b6e2-48d5-9195-7fcf05b459b0/v2.0> 
                emailClaim: email #<optional, default email>
                groupsClaim: groups #<optional, default groups>
                skipDiscovery: true #<optional, default false>
                insecureSkipVerifyNonce: false #<optional, default false>
              sessionStoreType: redis #<optional, default>
              cookieStore:
                minimal: false #<optional, default>
              redisStore:
                connectionUrl: "rediss://localhost:123" #<required>
              cookie:
                name: _oauth2_proxy2 #<optional, default>
                path: "/Authorize" #<optional, default>
                domain: "equinor.com" #<optional, default>
                expire: "168h" #<optional, default>
                refresh: "30m" #<optional, default>
      ports:
        - name: http
          port: 5005
      publicPort: http
      resources:
        requests:
          memory: "150M"
          cpu: "50m"
        limits:
          memory: "500M"
          cpu: "50m"
      replicas: 1
