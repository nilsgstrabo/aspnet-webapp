x-resources: &resources
  requests:
    memory: "150M"
    cpu: "100m"
  limits:
    memory: "500M"
    cpu: "100m"

x-secret-refs: &secret-refs
  azureKeyVaults:
    - name: radix-app-secrets
      path: /mnt/key-vault
      items:
        - name: connection-string-dev
          type: secret
          envVar: CONNECTION_STRING
        - name: key1
          type: key
          envVar: KEY1
        - name: cert1
          type: cert
          envVar: CERT1

x-component: &component
  resources: *resources
  secretRefs: *secret-refs

apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: oauth-demo
spec:
  environments:
    - name: prod
      build:
        from: release
    - name: dev
      build:
        from: main
  components:
    - name: web
      <<: *component
      variables:
        ASPNETCORE_URLS: http://*:5005
      ports:
        - name: http
          port: 5005
      publicPort: http
    - name: web2
      <<: *component
      variables:
        ASPNETCORE_URLS: http://*:5005
      ports:
        - name: http
          port: 5005
      publicPort: http
