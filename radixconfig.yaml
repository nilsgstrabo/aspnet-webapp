apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: nils-simple-webapp
spec:
  environments:
    - name: prod
    - name: qa
      build:
        from: main
  components:
    - name: "server"
      variables:
        ASPNETCORE_URLS: "http://*:5005"
      authentication:
        # oauth2:
          # clientId: 5687b237-eda3-4ec3-a2a1-023e85a2bd84 #<required>
          # scope: openid profile offline_access email 6dae42f8-4368-4678-94ff-3960e28e3630/user.read #<optional default: openid profile email offline_access>
          # setXAuthRequestHeaders: true #<optional, default false>
          # loginUrl: "foo" #<optional>
          # redeemUrl: "bar" #<optional>
          # proxyPrefix: "baz" #<optional, default /oauth2>
          # oidc:
            # issuerUrl: "1-foo" #<optional default to https://login.microsoftonline.com/3aa4a235-b6e2-48d5-9195-7fcf05b459b0/v2.0> 
            # jwksUrl: "1-bar" #<optional>
            # skipDiscovery: false #<optional, default false>
          # sessionStoreType: redis #<optional, default>
          # cookieStore:
            # minimal: true #<optional, default>
          # redisStore:
            # connectionUrl: "redis://localhost:123" #<required>
          # cookie:
          #   name: _oauth2_proxy #<optional, default>
          #   expire: "168h" #<optional, default>
          #   sameSite: "strict" #<optional, default>
      environmentConfig:
        - environment: qa
          authentication:
            oauth2:
              clientId: 5687b237-eda3-4ec3-a2a1-023e85a2bd84
              setXAuthRequestHeaders: true
              setAuthorizationHeader: true
              sessionStoreType: redis
              redisStore:
                connectionUrl: "rediss://auth-proxy-spike.redis.cache.windows.net:6380"
      ports:
        - name: http
          port: 5005
      publicPort: http
      resources:
        requests:
          memory: "150M"
          cpu: "50m"
        limits:
          memory: "500M"
          cpu: "50m"
      replicas: 1
